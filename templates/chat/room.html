{% extends 'base.html' %}

{% block content %}
<div class="container" style="max-width: 800px; margin-top: 20px; display: flex; flex-direction: column; height: 80vh;">
    <div class="chat-header" style="padding: 15px; border-bottom: 1px solid #ddd; display: flex; align-items: center; justify-content: space-between;">
        <h3>Chat with {{ other_user.name }}</h3>
        <a href="{{ url_for('chat.hub') }}" class="btn btn-secondary" style="text-decoration: none; color: #666;">&larr; Back</a>
    </div>

    <!-- Messages Area -->
    <div class="messages" style="flex: 1; overflow-y: auto; padding: 20px; background: #f9f9f9; border: 1px solid #eee;">
        {% for msg in messages %}
            <div class="message {% if msg.sender_id == current_user.id %}sent{% else %}received{% endif %}" 
                 style="margin-bottom: 10px; max-width: 70%; padding: 10px; border-radius: 10px; 
                 {% if msg.sender_id == current_user.id %}margin-left: auto; background: #007bff; color: white;{% else %}margin-right: auto; background: #e9ecef; color: black;{% endif %}">
                <p style="margin: 0;">{{ msg.content }}</p>
                <small style="display: block; font-size: 0.7em; opacity: 0.8; text-align: right; margin-top: 5px;">
                    {{ msg.timestamp.strftime('%H:%M') }}
                </small>
            </div>
        {% endfor %}
    </div>

    <!-- Input Area -->
    <div class="input-area" style="padding: 15px; border-top: 1px solid #ddd; background: white;">
        <form method="POST" style="display: flex; gap: 10px;">
            <input type="text" name="content" placeholder="Type your message..." required autocomplete="off"
                   style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <button type="submit" class="btn btn-primary" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Send</button>
        </form>
    </div>
</div>

<script>
    // Scroll to bottom of chat
    const messagesDiv = document.querySelector('.messages');
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
</script>
{% endblock %}